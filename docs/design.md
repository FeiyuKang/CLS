# 项目代号：CherryChain (智利车厘子冷链数字孪生)

## —— 基于 Rust 与 Three.js 的物流数字化教育模拟平台

### 1. 项目愿景与目标 (Project Vision)

**核心概念：** 本项目不是一个简单的“点击经营”游戏，而是一个**具有教育意义的硬核物流模拟器**。
**教育目的：** 让玩家/用户理解现代物流不仅仅是运输，而是**数据的流动**。通过模拟从智利果园到中国餐桌的“车厘子快线”，展示数据监控、冷链管理、风险控制和算法优化在供应链中的核心作用。

---

### 2. 模拟场景：跨洋车厘子快线 (The Scenario)

**背景：** 每年 11 月至次年 2 月，数万吨车厘子需跨越 20,000 公里，从南半球夏季运往北半球冬季。
**核心冲突：**

* **极度易腐：** 脱离冷链数小时即贬值。
* **价格波动：** 春节前价格高企，春节后断崖式下跌。
* **海量并发：** 每天可能有数十艘船、数千个集装箱在海上漂浮。

---

### 3. 功能模块架构 (Functional Architecture)

我们将系统分为三个核心子系统：**运营管理端 (ERP)**、**数据分析端 (BI)**、**3D 可视化端 (Digital Twin)**。

#### A. 运营管理系统 (Management System)

玩家的操作面板，用于制定策略。

* **采购与发货：** 决定使用哪种运输方式（海运快船 vs 空运包机）。
* **温控配置：** 设置冷藏箱（Reefer）的目标温度（如 ）和气体成分（气调保鲜）。
* **异常处理：** 当后端传来“冷机故障”报警时，玩家需决策（就近港口卸货 / 降价预售）。

#### B. 数据分析系统 (Data Analysis & BI)

展示“数据驱动决策”的价值。

* **实时质量预测：** 基于当前温度积分，计算货物的**剩余货架期 (Shelf-life)**。
* **财务看板：** 实时 ROI 计算（运费成本 vs 预计到港售价）。
* **波动图表：** 历史温度曲线、港口拥堵指数。

#### C. 可视化系统 (Visualization System)

基于 WebGL 的数字孪生界面。

* **宏观视图：** 3D 地球，显示全球航线网络、船只位置。
* **微观视图：** 点击单艘船，透视看到内部集装箱堆叠，颜色代表温度分布。

---

### 4. 技术架构方案 (Technical Architecture)

采用 **前后端分离** 架构，强调高性能计算与实时渲染。

#### 后端：Rust (高性能仿真引擎)

**职责：** 维护整个世界的“真理”，处理高并发状态更新。

* **框架：** `Axum` 或 `Actix-web` (HTTP/WebSocket 服务)。
* **核心逻辑 (ECS模式)：**
* **Entity:** 每一个集装箱 (Container) 都是一个独立实体。
* **Component:** 位置组件 、环境组件 、货物组件 (Quality)。
* **System:**
* `MovementSystem`: 计算船只在地球表面的位移。
* `DecaySystem`: 根据阿伦尼乌斯方程 (Arrhenius equation) 每 tick 计算一次车厘子品质损耗。




* **数据流：** 通过 WebSocket 每秒推送一次压缩后的差异数据 (Diff) 给前端。

#### 前端：Three.js + React/Vue (可视化呈现)

**职责：** 解析后端数据，进行视觉渲染和交互。

* **3D 引擎：** `Three.js` (推荐使用 `React-Three-Fiber` 以便于组件化管理)。
* **UI 层：** HTML/CSS 覆盖在 Canvas 之上，用于显示图表和按钮。
* **渲染策略：**
* **InstancedMesh:** 用于渲染成千上万个集装箱或同类船只，保证 60fps 流畅度。
* **Shaders (GLSL):** 编写自定义着色器来绘制发光的航线和动态的海浪，降低 CPU 负载。



---

### 5. 核心数据模型与算法 (Data & Algorithms)

这是体现“硬核教育”的关键部分。

#### (1) 腐损算法 (The Decay Model)

后端 Rust 需实现简化的品质衰减公式：


* : 果实硬度/糖度
* : 实时温度（这是玩家需要控制的变量）
* **教育点：** 让玩家看到，温度波动 2 度，最终货损可能增加 20%。

#### (2) 路径规划 (Pathfinding)

* 不使用简单的直线，而是基于球面的**大圆航线 (Great Circle Route)**。
* 引入**随机扰动因子**（模拟风暴、洋流），影响航速。

---

### 6. 实施路线图 (Implementation Roadmap)

我们将开发分为四个阶段 (Sprints)：

#### 第一阶段：原型验证 (MVP) - "连通世界"

* **目标：** Rust 后端跑通 WebSocket，前端 Three.js 显示一个球体和一个移动的点。
* **产出：** 能够看到一个方块从智利坐标移动到中国坐标，且位置由 Rust 计算。

#### 第二阶段：可视化升级 - "数据之美"

* **目标：** 引入地球贴图、发光航线、船只模型。
* **产出：** 视觉上具有科技感的 3D 地球，支持缩放旋转。

#### 第三阶段：核心模拟 - "时间与腐烂"

* **目标：** 接入腐损算法和温度变量。
* **产出：** 玩家可以看到集装箱颜色的变化（由绿变红代表腐坏），UI 显示实时数据图表。

#### 第四阶段：游戏循环 - "经营与挑战"

* **目标：** 加入金钱系统、突发事件（港口罢工、设备故障）。
* **产出：** 完整的可玩版本，包含记分板和关卡结算。
